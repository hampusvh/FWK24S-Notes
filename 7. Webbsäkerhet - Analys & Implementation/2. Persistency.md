# Sammanfattning – Persistens & Tillstånd

## Översikt
Begreppen *tillstånd (state)* och *persistens (persistency)* handlar om hur data hanteras, sparas och bevaras i ett system.  
Tillstånd beskriver vilket läge en applikation befinner sig i just nu, medan persistens handlar om att spara data så att den finns kvar även efter att programmet avslutats.

---

## Tillstånd
State är den information en applikation “kommer ihåg” mellan användarens handlingar.  
Det kan vara inloggningsstatus, inställningar, formulärdata eller gränssnittets aktuella läge.

I webbutveckling – särskilt i React – används state för att hålla ordning på data som ändras över tid och för att avgöra när gränssnittet ska uppdateras.

---

## Persistens
Persistens innebär att data lagras på ett sätt som överlever programstopp eller systemomstarter, t.ex. i:
- databaser  
- filer på disk  
- molnlagring  

Det gör att data kan delas, återställas efter krascher och användas mellan olika sessioner.  
Utan persistens skulle all data gå förlorad när applikationen stängs.

---

## HTTP och stateless design
HTTP-protokollet är i grunden stateless – varje förfrågan är oberoende och servern minns inget mellan dem.  
För att skapa en “ihågkommande” upplevelse används olika tekniker:
- cookies  
- tokens (t.ex. JWT)  
- sessioner via servern  
- localStorage och sessionStorage i webbläsaren  

Det är dessa som gör att webben kan hantera inloggningar och personliga inställningar.

---

## Tidiga lösningar och risker
I början (kring 1989) skickades sessions-ID direkt i URL:en, t.ex. `?session_id=12345`.  
Det ledde till stora säkerhetsproblem:
- ID:n kunde synas i loggar eller delas via länkar  
- XSS-attacker kunde stjäla sessioner  
- referer-headers kunde läcka data  
- brist på HTTPS gjorde att ID:n skickades i klartext  

Dessa problem blev grunden för utvecklingen av cookies och bättre säkerhetsmekanismer.

---

## Cookies och säkerhetsattribut

Cookies infördes 1994 av Netscape för att lösa problemet med att behålla tillstånd.  
Senare tillkom viktiga säkerhetsförbättringar:

- **HttpOnly** (2000): gör cookien osynlig för JavaScript.  
- **Secure**: skickar bara cookien över HTTPS.  
- **SameSite** (2016): skyddar mot CSRF-attacker.  

---

## Modern lagring

HTML5 lade till `localStorage` och `sessionStorage` för att spara data direkt i webbläsaren.  

Det används ofta för enklare användardata men kräver försiktighet – känslig information ska inte lagras där.

---

## Säkerhet och ansvar

Webbläsaren ansvarar till stor del för att tolka och upprätthålla säkerhetsattribut som HttpOnly och CORS.  

Om någon får fysisk tillgång till datorn finns dock inga garantier – då är all lagrad data sårbar.

---

## Sammanfattning

- *Tillstånd* handlar om applikationens aktuella läge.  
- *Persistens* handlar om att spara det läget över tid.  
- HTTP är stateless, så utvecklare måste själva hantera state och persistens.  
- Cookies, tokens och moderna lagringsmetoder används för detta, men kräver rätt säkerhetsinställningar.  

Det här är grunden för hur webbapplikationer idag kan vara både dynamiska, säkra och användarvänliga.
